<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitLab Pipeline Generator</title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/slim-select@2.8.0/dist/slimselect.min.css">
    <script src="https://cdn.jsdelivr.net/npm/slim-select@2.8.0/dist/slimselect.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>
<body class="dark-mode">
    <div class="container">
        <!-- User Section moved above title -->
        <div id="user-section">
            <div id="login-form">
                <input type="text" id="username" placeholder="Username" required>
                <input type="password" id="password" placeholder="Password" required>
                <button id="login-btn">Login</button>
                <div id="login-error" style="color: red; display: none;"></div>
            </div>
            <div id="logged-in-user" style="display: none;">
                <span id="current-user"></span>
                <button id="logout-btn">Logout</button>
            </div>
        </div>
        <!-- <div id="admin-create-user" style="display:none; margin-top: 30px;">
            <h3>Create New User (Admin Only)</h3>
            <input id="new-username" placeholder="Username" />
            <input id="new-password" placeholder="Password" type="password" />
            <input id="new-name" placeholder="Full Name" />
            <button id="create-user-btn">Create User</button>
            <div id="create-user-msg"></div>
        </div> -->
        <div id="admin-section" style="display:none; margin-top: 20px;">
            <h3>Create New User (Admin Only)</h3>
            <input type="text" id="new-username" placeholder="Username">
            <input type="text" id="new-name" placeholder="Full Name">
            <input type="password" id="new-password" placeholder="Password">
            <button id="create-user-btn">Create User</button>
            <div id="admin-feedback" style="margin-top:10px; color:green;"></div>
        
            <h3 style="margin-top:20px;">User List</h3>
            <ul id="user-list" style="list-style:none; padding-left:0;"></ul>
        </div>
        <div id="app-content" style="display: none;">
            <header>
                <h1>GitLab Pipeline Generator</h1>
                <button id="edit-games-button" onclick="toggleEditGames()">EDIT GAMES LIST</button>
                <div class="mode-toggle" onclick="toggleMode()">ðŸŒ“</div>
            </header>

            <div class="sub-title">Select on which environment to run</div>
            <div id="env-section">
                <select id="env-selector">
                  <option value="FW_STAGE_ENV">Stage</option>
                  <option value="FW_QA01_ENV">QA01</option>
                  <option value="FW_QA02_ENV">QA02</option>
                  <option value="FW_QA03_ENV">QA03</option>
                  <option value="FW_QA04_ENV">QA04</option>
                  <option value="FW_QA05_ENV">QA05</option>
                  <option value="FW_QA06_ENV">QA06</option>
                  <option value="FW_QA07_ENV">QA07</option>
                  <option value="FW_QA08_ENV">QA08</option>
                  <option value="FW_QA09_ENV">QA09</option>
                </select>
            </div>

            <div class="sub-title">Actions for All Games</div>
            <div class="buttons-container">
                <div class="left-buttons">
                    <button onclick="toggleButton(this)">ALL</button>
                    <button onclick="toggleButton(this)">PAYOUTS</button>
                    <button onclick="toggleButton(this)">UI</button>
                    <button onclick="toggleButton(this)">ANALYTICS</button>
                    <button onclick="toggleButton(this)">SMAPP</button>
                    <button onclick="toggleButton(this)">DESKTOP</button>
                    <button onclick="toggleButton(this)">MOBILE</button>
                    <button onclick="clearButtons()">CLEAR</button>
                </div>
                <!-- <button id="generate-btn" disabled>Generate Pipeline</button> -->
            </div>

            <div id="edit-games">
                <h3>Games List</h3>
                <p>*any changes will be lost on page reload</p>
                <div id="games-list-container">
                    <!-- Default games will be added here dynamically -->
                </div>
                <button id="add-game-button" onclick="addGameEntry()">ADD GAME</button>
                <button id="save-games-button" onclick="saveGamesList()">SAVE GAMES LIST</button>
            </div>

            <div class="sub-title-2">Actions per Game</div>
            <table>
                <thead>
                    <tr>
                        <th rowspan="2">RUN</th>
                        <th id="game-name-header" rowspan="2">Game Name</th>
                        <th colspan="4">Desktop & Mobile</th>
                        <th colspan="4">Desktop</th>
                        <th colspan="3">Mobile</th>
                    </tr>
                    <tr>
                        <th>All</th>
                        <th>Payouts</th>
                        <th>UI</th>
                        <th>Analytics</th>
                        <th>SMApp</th>
                        <th>Desktop Payouts</th>
                        <th>Desktop UI</th>
                        <th>Desktop Analytics</th>
                        <th>Mobile Payouts</th>
                        <th>Mobile UI</th>
                        <th>Mobile Analytics</th>
                    </tr>
                </thead>
                <tbody id="table-body">
                    <!-- Rows will be generated here -->
                </tbody>
            </table>

            <!-- Moved Copy Button and Textarea -->
            <div class="output-container">
                <textarea id="output-text" readonly></textarea>
                <!-- <button class="copy-button" onclick="copyText()">COPY</button> -->
                <button id="generate-btn" disabled>Generate Pipeline</button>
            </div>

            <!-- Moved Generate Pipeline Button -->
            <div class="pipeline-controls">
                <div class="sub-title">Select on which branch to run</div>
                <div id="branch-load-error" class="error-message" style="display: none;"></div>
                <div id="pipeline-trigger-section" style="display: none;">
                    <div class="branch-selection-container">
                        <select id="branch-selector" class="branch-selector"></select>
                    </div>
                </div>
                <button id="trigger-btn" class="trigger-button">Trigger Pipeline</button>
            </div>

            <div id="pipeline-search-section" style="margin: 30px 20px;">
                <h3>Search Past Pipeline or Job</h3>
                <input type="text" id="search-id" placeholder="Enter Pipeline ID or Job ID" />
                <button id="search-btn">Search</button>
                <div id="search-results"></div>
            </div>

            <!-- Expanded Pipeline Info Section -->
            <section id="pipeline-info">
                <h2>Pipeline Information</h2>
                <div id="pipeline-status" class="placeholder">
                    No pipeline generated or triggered yet.
                </div>
                <div id="pipeline-summary-container"></div>
            </section>
        </div>
    </div>
    <script src="/js/app.js"></script>
</body>
</html>